[2025-12-25 16:34:33,257] [   ERROR] database.py:32 - Database error: the JSON object must be str, bytes or bytearray, not NoneType
[2025-12-25 16:34:33,257] [   ERROR] database.py:181 - Error getting invoices: the JSON object must be str, bytes or bytearray, not NoneType  
PLANS: implement a mini ML model to learn products from the json files for to when upload a invoice that has different product-->know it is a product
Fine tune vietnamese.
fix more bugs

FIX BUG: admin page: Failed to clear cache: Invalid JSON , analytic become Cache in refersh page.


## ðŸ“˜ System Summary & Integration Guide

### 1. The "Brain" (Google Colab)
This notebook acts as the high-performance AI backend. It is stateless regarding business data but stateful regarding AI context (loaded models).

**Key Components Loaded:**
*   **Core LLM:** `sonthaiha/project-a-14b` (Qwen 2.5 Coder 14B Finetuned) - Handles reasoning, SQL generation, and conversation.
*   **Vision Engine:** `Qwen2-VL-2B-Instruct` - Used for analyzing charts and images uploaded by users.
*   **RAG System:** `ChromaDB` - Stores vector embeddings of policy documents (PDFs) to answer static questions (e.g., "Return policy").
*   **API Server:** `FastAPI` (in `src/server.py`) - Exposes the AI via HTTP.
*   **Tunnel:** `Ngrok` - Makes the local Colab port (8000) accessible publicly.

### 2. Integration Strategy: Hostinger â†” Colab

**Configuration on Hostinger:**
In your Flask/Node.js app on Hostinger, set these environment variables:
*   `AI_SERVICE_URL`: The HTTPS URL generated by Ngrok in this notebook (e.g., `https://xyz.ngrok-free.app`).
*   `AI_SHARED_KEY`: The secret key defined in this notebook (e.g., `super-secret-shared`).

**The "Tool Use" Workflow (Secure DB Access):**
This allows the AI to query your database without ever knowing your DB credentials.

**Step 1: User Asks Question**
*   **User:** "How many red dresses did we sell last week?"
*   **Hostinger App:** Sends a POST request to `AI_SERVICE_URL/chat`.
    ```json
    {
      "prompt": "How many red dresses did we sell last week?",
      "user_id": "123",
      "db_schema": "TABLE sales (id INT, product TEXT, quantity INT, date DATE)..."
    }
    ```

**Step 2: AI Reasoning (Colab)**
*   The LLM analyzes the prompt and schema.
*   **Response from AI:** It does not answer yet. It returns a "Tool Call".
    ```json
    {
      "type": "tool_call",
      "tool": "query_db",
      "params": {
        "sql": "SELECT SUM(quantity) FROM sales WHERE product LIKE '%red dress%' AND date >= DATE('now', '-7 days')"
      }
    }
    ```

**Step 3: Execution (Hostinger)**
*   Your Hostinger App detects `type: "tool_call"`.
*   It executes the `sql` provided in `params` against its local database.
*   **Result:** `50`.

**Step 4: Final Answer**
*   **Hostinger App:** Sends the result back to Colab.
    ```json
    {
      "role": "tool_result",
      "content": "50"
    }
    ```
*   **Colab:** Generates the natural language response.
    ```json
    {
      "type": "message",
      "content": "We sold 50 red dresses last week."
    }
    ```

### 3. Maintenance
*   **Start Up:** Run the Execution cells at the bottom of this notebook every time you start the Colab runtime.
*   **Update URL:** Copy the new Ngrok URL into your Hostinger App's configuration.
*   **Logs:** Monitor the cell output here for any AI errors.
3.  **Bridge:** Update `app.py` to read `AI_SERVICE_URL` and implement the "Tool Execution Loop".

connect node : at the connect mode function, if user DOUBLE CLICK on the connection line, the line delete, the connection gone.

Sceanrio: Fix the dark theme, fix the logic (it supposed to be like prebuilt workflow or whatever you can think of or sth???In the workflow page, the save function should be ask either save as "Saved workflow" or "saved scenario", check database), function delete create.... etc failed.