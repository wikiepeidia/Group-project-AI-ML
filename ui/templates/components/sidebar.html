<button id="mobile-sidebar-toggle" class="mobile-sidebar-toggle" aria-label="Toggle Menu">
    <i class="fas fa-bars"></i>
</button>
<div id="sidebar-overlay" class="sidebar-overlay"></div>

<nav class="modern-sidebar" id="main-sidebar">
    <div class="sidebar-brand">
        <div class="brand-icon">
            <i class="fas fa-rocket"></i>
        </div>
        <div class="brand-text">
            <h3>{{ project_name }}</h3>
            <p>Smart Management</p>
        </div>
    </div>

    <div class="user-profile-card">
        <div class="user-avatar-lg">
            {% if user.avatar %}
            <img src="{{ user.avatar }}" alt="Avatar"
                style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">
            {% else %}
            {{ ((user.first_name or user.name or user.email) if user.first_name or user.name else user.email)[0]|upper
            }}
            {% endif %}
        </div>
        <div class="user-info">
            <div class="user-name">{{ user.name or 'User' }}</div>
            <div class="user-email">{{ user.email }}</div>
            <span class="role-badge role-{{ user.role }}">
                <i
                    class="fas fa-{{ 'crown' if user.role == 'admin' else 'user-shield' if user.role == 'manager' else 'user' }}"></i>
                {{ user.role|upper }}
            </span>
        </div>
    </div>

    <div class="menu-container">
        <!-- Admin Section: System Administration -->
        {% if user.role == 'admin' %}
        <div class="menu-section">
            <div class="section-title">
                <i class="fas fa-crown"></i>
                <span>Platform Administration</span>
            </div>
            <a class="menu-item" href="{{ url_for('admin_dashboard') }}">
                <div class="menu-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"><i
                        class="fas fa-tachometer-alt"></i></div>
                <div class="menu-label">Admin Dashboard</div>
                <div class="menu-arrow"><i class="fas fa-chevron-right"></i></div>
            </a>
            <a class="menu-item" href="{{ url_for('admin_analytics') }}">
                <div class="menu-icon" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);"><i
                        class="fas fa-chart-line"></i></div>
                <div class="menu-label">Analytics & Reports</div>
                <div class="menu-arrow"><i class="fas fa-chevron-right"></i></div>
            </a>
            <a class="menu-item" href="{{ url_for('admin_subscriptions') }}">
                <div class="menu-icon" style="background: linear-gradient(135deg, #ffd89b 0%, #ff8a00 100%);"><i
                        class="fas fa-credit-card"></i></div>
                <div class="menu-label">Manage Subscriptions</div>
                <div class="menu-arrow"><i class="fas fa-chevron-right"></i></div>
            </a>
        </div>
        {% endif %}

        <!-- Manager Section: Tạo tài khoản User -->
        {% if user.role == 'manager' %}
        <div class="menu-section">
            <div class="section-title">
                <i class="fas fa-user-plus"></i>
                <span>User Management</span>
            </div>
            <a class="menu-item" href="{{ url_for('create_user_account') }}">
                <div class="menu-icon"><i class="fas fa-user-plus"></i></div>
                <div class="menu-label">Create user account</div>
                <div class="menu-arrow"><i class="fas fa-chevron-right"></i></div>
            </a>
        </div>
        {% endif %}

        <!-- Main Menu: Dành cho Manager/Admin -->
        {% if user.role in ['admin', 'manager'] %}
        <div class="menu-section">
            <div class="section-title">
                <i class="fas fa-store"></i>
                <span>My Store Management</span>
            </div>
            <a class="menu-item" href="{{ url_for('dashboard') }}">
                <div class="menu-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);"><i
                        class="fas fa-chart-pie"></i></div>
                <div class="menu-label">Store Dashboard</div>
                <div class="menu-arrow"><i class="fas fa-chevron-right"></i></div>
            </a>
            <a class="menu-item" href="{{ url_for('customers') }}">
                <div class="menu-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"><i
                        class="fas fa-users"></i></div>
                <div class="menu-label">Customers</div>
                <div class="menu-arrow"><i class="fas fa-chevron-right"></i></div>
            </a>
            {% if user.role != 'admin' %}
            <a class="menu-item" href="{{ url_for('wallet_dashboard') }}">
                <div class="menu-icon" style="background: linear-gradient(135deg, #1f2937 0%, #111827 100%);"><i
                        class="fas fa-wallet"></i></div>
                <div class="menu-label">Wallet & Plans</div>
                <div class="menu-arrow"><i class="fas fa-chevron-right"></i></div>
            </a>
            {% endif %}
        </div>
        {% endif %}

        <!-- User Menu: Basic features -->
        {% if user.role == 'user' %}
        <div class="menu-section">
            <div class="section-title">
                <i class="fas fa-store"></i>
                <span>Business Management</span>
            </div>
            <a class="menu-item" href="{{ url_for('customers') }}">
                <div class="menu-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"><i
                        class="fas fa-users"></i></div>
                <div class="menu-label">Customers</div>
                <div class="menu-arrow"><i class="fas fa-chevron-right"></i></div>
            </a>
        </div>
        {% endif %}

        <!-- Workspace -->
        <div class="menu-section">
            <div class="section-title">
                <i class="fas fa-rocket"></i>
                <span>Workspace</span>
            </div>
            <a class="menu-item" href="{{ url_for('workspace') }}">
                <div class="menu-icon" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);"><i
                        class="fas fa-paint-brush"></i></div>
                <div class="menu-label">Workspace Hub</div>
                <div class="menu-arrow"><i class="fas fa-chevron-right"></i></div>
            </a>
            <a class="menu-item" href="{{ url_for('scenarios') }}">
                <div class="menu-icon" style="background: linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%);"><i
                        class="fas fa-project-diagram"></i></div>
                <div class="menu-label">Automation Scenarios</div>
                <div class="menu-arrow"><i class="fas fa-chevron-right"></i></div>
            </a>
            <a class="menu-item" href="{{ url_for('settings') }}">
                <div class="menu-icon" style="background: linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%);"><i
                        class="fas fa-cog"></i></div>
                <div class="menu-label">Settings</div>
                <div class="menu-arrow"><i class="fas fa-chevron-right"></i></div>
            </a>
        </div>

        <!-- Logout -->
        <div class="menu-footer">
            <a class="logout-button" href="{{ url_for('logout') }}">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </a>
        </div>
    </div>
</nav>