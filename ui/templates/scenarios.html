{% extends "base.html" %}

{% block title %}Automation Scenarios - Workflow Automation for Retail{% endblock %}

{% block body_class %}scenarios-page{% endblock %}

{% block styles %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/scenarios.css') }}">
{% endblock %}

{% block content %}
<div class="scenario-container">
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <a href="{{ url_for('dashboard') }}" class="text-decoration-none text-reset">
                    <i class="fas fa-arrow-left me-2"></i> Back
                </a>
                <div class="user-menu">
                    {% set avatar_source = (user.first_name or user.last_name or user.email or 'U') %}
                    <div class="user-avatar">{{ avatar_source[:1]|upper }}</div>
                </div>
            </div>
            <div class="mb-3">
                <div class="fw-bold">{{ user.name }}</div>
                <div class="small opacity-75 text-truncate">{{ user.email }}</div>
            </div>

            <div class="sidebar-title">Search</div>
            <div class="search-box mt-2">
                <input type="text" class="search-input" placeholder="Search scenarios..." data-scenarios-search>
                <i class="fas fa-search search-icon"></i>
            </div>
        </div>

        <div class="folders-section">
            <div class="folder-header">
                <span>FOLDERS</span>
                <button class="add-folder-btn" onclick="createFolder()">
                    <i class="fas fa-plus"></i>
                </button>
            </div>

            <div class="folder-item active" data-folder-item="all" onclick="selectFolder('all')">
                <div class="folder-icon">
                    <i class="fas fa-folder" style="color: #667eea;"></i>
                </div>
                <div class="folder-info">
                    <div class="folder-name">All scenarios</div>
                    <div class="folder-count" data-folder-count="all">0 scenarios</div>
                </div>
            </div>

            <div class="folder-item" data-folder-item="uncategorized" onclick="selectFolder('uncategorized')">
                <div class="folder-icon">
                    <i class="fas fa-folder-open" style="color: #6c757d;"></i>
                </div>
                <div class="folder-info">
                    <div class="folder-name">Uncategorized</div>
                    <div class="folder-count" data-folder-count="uncategorized">0 scenarios</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="content-header">
            <div>
                <div class="nav-breadcrumb">
                    <a href="/workspace" class="nav-link">Workspace</a>
                    <span class="nav-separator">></span>
                    <span>Scenarios</span>
                </div>
                <h1 class="content-title">All scenarios</h1>
                <div class="content-tabs">
                    <div class="tab active" data-tab="all">
                        ALL
                        <span class="tab-badge" data-tab-count="all">0</span>
                    </div>
                    <div class="tab" data-tab="active">
                        ACTIVE SCENARIOS
                        <span class="tab-badge" data-tab-count="active">0</span>
                    </div>
                    <div class="tab" data-tab="inactive">
                        INACTIVE SCENARIOS
                        <span class="tab-badge" data-tab-count="inactive">0</span>
                    </div>
                    <div class="tab" data-tab="concept">
                        CONCEPTS
                        <span class="tab-badge" data-tab-count="concept">0</span>
                    </div>
                </div>
            </div>
            <button class="create-btn" onclick="createScenario()">
                <i class="fas fa-plus"></i>
                Create scenario
            </button>
        </div>

        <div class="content-area">
            <!-- Empty State -->
            <div class="empty-state" data-scenarios-empty>
                <div class="empty-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <h2 class="empty-title">Create your first Scenario</h2>
                <p class="empty-description">
                    In order for Make to automate your tasks for you, you have to create a scenario.
                    Open the builder to create your first scenario or browse our templates for inspiration and easy
                    start.
                </p>
                <div class="empty-actions">
                    <button class="create-btn" onclick="openBuilder()">
                        Open Scenario Builder
                    </button>
                    <button class="btn-secondary" onclick="browseTemplates()">
                        Browse Templates
                    </button>
                </div>
            </div>

            <!-- Scenarios Grid (will be populated dynamically) -->
            <div class="scenarios-grid" id="scenariosGrid" data-scenarios-grid hidden>
                <!-- Scenario cards will be inserted here -->
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="{{ url_for('static', filename='js/scenarios.js') }}" defer></script>
{% endblock %}

<!-- Create/Edit Scenario Modal -->
<div class="modal fade" id="scenarioModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header border-0 pb-0">
                <h5 class="modal-title fw-bold" id="scenarioModalLabel">Create New Scenario</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="scenarioForm">
                    <input type="hidden" id="scenarioId">
                    <div class="mb-3">
                        <label for="scenarioName" class="form-label">Scenario Name</label>
                        <input type="text" class="form-control" id="scenarioName" required
                            placeholder="e.g., Email Automation">
                    </div>
                    <div class="mb-3">
                        <label for="scenarioDescription" class="form-label">Description</label>
                        <textarea class="form-control" id="scenarioDescription" rows="3"
                            placeholder="Describe what this scenario does..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer border-0 pt-0">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveScenario()">Save Scenario</button>
            </div>
        </div>
    </div>
</div>

<!-- Tutorial Modal -->
<div class="modal fade" id="tutorialModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header border-0 pb-0">
                <h5 class="modal-title fw-bold">Welcome to Workflow Automation!</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body pt-2">
                <p class="text-muted mb-4">It looks like you're new here. Would you like a quick tour on how to set up
                    your first automation?</p>

                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="card h-100 border-0 bg-light tutorial-card">
                            <div class="card-body text-center p-4">
                                <div class="mb-3 text-primary">
                                    <i class="fab fa-slack fa-3x"></i>
                                </div>
                                <h5>Slack Integration</h5>
                                <p class="small text-muted">Learn how to create a webhook to send notifications to Slack
                                    channels.</p>
                                <a href="https://api.slack.com/messaging/webhooks" target="_blank"
                                    class="btn btn-outline-primary btn-sm stretched-link">View Guide</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card h-100 border-0 bg-light tutorial-card">
                            <div class="card-body text-center p-4">
                                <div class="mb-3 text-danger">
                                    <i class="fab fa-google fa-3x"></i>
                                </div>
                                <h5>Gmail Automation</h5>
                                <p class="small text-muted">Set up triggers for new emails and automate responses.</p>
                                <a href="https://developers.google.com/gmail/api/guides" target="_blank"
                                    class="btn btn-outline-danger btn-sm stretched-link">View Guide</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card h-100 border-0 bg-light tutorial-card">
                            <div class="card-body text-center p-4">
                                <div class="mb-3 text-success">
                                    <i class="fas fa-file-excel fa-3x"></i>
                                </div>
                                <h5>Excel/Sheets Sync</h5>
                                <p class="small text-muted">Automatically sync data between your database and
                                    spreadsheets.</p>
                                <a href="#" class="btn btn-outline-success btn-sm stretched-link">View Guide</a>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card h-100 border-0 bg-light tutorial-card">
                            <div class="card-body text-center p-4">
                                <div class="mb-3 text-info">
                                    <i class="fas fa-project-diagram fa-3x"></i>
                                </div>
                                <h5>Building Workflows</h5>
                                <p class="small text-muted">Master the drag-and-drop builder to create complex logic.
                                </p>
                                <a href="#" class="btn btn-outline-info btn-sm stretched-link">Start Tutorial</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer border-0 pt-0">
                <div class="form-check me-auto">
                    <input class="form-check-input" type="checkbox" id="dontShowAgain">
                    <label class="form-check-label text-muted small" for="dontShowAgain">
                        Don't show this automatically again
                    </label>
                </div>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Maybe Later</button>
                <button type="button" class="btn btn-primary" onclick="startInteractiveTutorial()">Start Tour</button>
            </div>
        </div>
    </div>
</div>

<style>
    /* Dark mode support for modal */
    [data-theme="dark"] .modal-content {
        background-color: var(--surface-100);
        color: var(--gray-100);
    }

    [data-theme="dark"] .tutorial-card {
        background-color: var(--surface-200) !important;
    }

    [data-theme="dark"] .text-muted {
        color: var(--gray-400) !important;
    }

    [data-theme="dark"] .btn-close {
        filter: invert(1) grayscale(100%) brightness(200%);
    }
</style>